<?xml version="1.0" encoding="UTF-8"?>
<operatorModel xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://www.ibm.com/xmlns/prod/streams/spl/operator" xmlns:cmn="http://www.ibm.com/xmlns/prod/streams/spl/common" xsi:schemaLocation="http://www.ibm.com/xmlns/prod/streams/spl/operator operatorModel.xsd">
  <cppOperatorModel>
    <context>
      <description>
Query reads SPL data from MongoDB collection. No predefined db schema is required, the data is automatically mapped from BSON to SPL.
The operator uses db connection pool and supports multiple threads. It has three custom output functions: QueryDocumentField, QueryDocumentFieldAsJson and QueryDocumentMultipleFields.

Multiple input ports are allowed and their attributes can be used in multiple InsertDocument calls, but cannot be mixed in the same call.

One output port is defined for use with custom output functions and optionally to propogate returned errors downstream.
      </description>
      <metrics>
        <metric>
          <name>dbConnectionPoolSize</name>
          <description/>
          <kind>Gauge</kind>
        </metric>
      </metrics>
      <customOutputFunctions>
        <customOutputFunction>
          <name>MongoFS</name>
          <function pseudoFunction="true">
            <description></description>
            <prototype>&lt;any T> T AsIs(T v)</prototype>
          </function>
          <function pseudoFunction="true">
            <description></description>
            <prototype>&lt;string T> T QueryDocumentFieldAsJson()</prototype>
          </function>
          <function pseudoFunction="true">
            <description></description>
            <prototype>&lt;any T> T QueryDocumentField()</prototype>
          </function>
          <function>
            <description></description>
            <prototype>&lt;any T> T QueryDocumentField(rstring findPath)</prototype>
          </function>
          <function pseudoFunction="true">
            <description></description>
            <prototype>&lt;any T> T QueryDocumentMultipleFields()</prototype>
          </function>
          <function>
            <description></description>
            <prototype>&lt;any T> T QueryDocumentMultipleFields(rstring findPath)</prototype>
          </function>
        </customOutputFunction>
      </customOutputFunctions>
      <libraryDependencies>
        <library>
          <cmn:description></cmn:description>
          <cmn:managedLibrary>
            <cmn:lib>mongoclient</cmn:lib>
            <cmn:libPath>../../impl/lib</cmn:libPath>
            <cmn:includePath>../../impl/include</cmn:includePath>
            <cmn:command>../../impl/bin/setLinks.sh</cmn:command>
          </cmn:managedLibrary>
        </library>
      </libraryDependencies>
      <providesSingleThreadedContext>Always</providesSingleThreadedContext>
      <allowCustomLogic>false</allowCustomLogic>
      <codeTemplates>
        <codeTemplate name="Query">
          <description>Basic Query template</description>
          <template>stream&lt;${schema}> ${outputStream} = Query(${inputStream}) {
	param
		dbHost : &quot;&quot;;
		dbName : &quot;&quot;;
		collection : &quot;&quot;;
	output ${outputStream} :
		attr = QueryDocumentField();
}</template>
        </codeTemplate>
      </codeTemplates>
    </context>
    <parameters>
      <description></description>
      <allowAny>false</allowAny>
      <parameter>
        <name>collection</name>
        <description></description>
        <optional>false</optional>
        <rewriteAllowed>true</rewriteAllowed>
        <expressionMode>AttributeFree</expressionMode>
        <type>rstring</type>
        <cardinality>1</cardinality>
      </parameter>
      <parameter>
        <name>dbName</name>
        <description></description>
        <optional>false</optional>
        <rewriteAllowed>true</rewriteAllowed>
        <expressionMode>AttributeFree</expressionMode>
        <type>rstring</type>
        <cardinality>1</cardinality>
      </parameter>
      <parameter>
        <name>dbHost</name>
        <description></description>
        <optional>false</optional>
        <rewriteAllowed>true</rewriteAllowed>
        <expressionMode>AttributeFree</expressionMode>
        <type>rstring</type>
        <cardinality>1</cardinality>
      </parameter>
      <parameter>
        <name>dbPort</name>
        <description></description>
        <optional>true</optional>
        <rewriteAllowed>true</rewriteAllowed>
        <expressionMode>AttributeFree</expressionMode>
        <type>uint32</type>
        <cardinality>1</cardinality>
      </parameter>
      <parameter>
        <name>findFields</name>
        <description sampleUri=""></description>
        <optional>true</optional>
        <rewriteAllowed>false</rewriteAllowed>
        <expressionMode>Expression</expressionMode>
        <type>map&lt;rstring,int32></type>
        <cardinality>1</cardinality>
      </parameter>
      <parameter>
        <name>findQuery</name>
        <description></description>
        <optional>true</optional>
        <rewriteAllowed>false</rewriteAllowed>
        <expressionMode>Expression</expressionMode>
        <type></type>
        <cardinality>1</cardinality>
      </parameter>
      <parameter>
        <name>nToReturn</name>
        <description></description>
        <optional>true</optional>
        <rewriteAllowed>true</rewriteAllowed>
        <expressionMode>Expression</expressionMode>
        <type>uint32</type>
        <cardinality>1</cardinality>
      </parameter>
      <parameter>
        <name>timeout</name>
        <description></description>
        <optional>true</optional>
        <rewriteAllowed>true</rewriteAllowed>
        <expressionMode>AttributeFree</expressionMode>
        <type>float64</type>
        <cardinality>1</cardinality>
      </parameter>
    </parameters>
    <inputPorts>
      <inputPortSet>
        <description></description>
        <windowingDescription></windowingDescription>
        <tupleMutationAllowed>false</tupleMutationAllowed>
        <windowingMode>NonWindowed</windowingMode>
        <windowPunctuationInputMode>Oblivious</windowPunctuationInputMode>
        <cardinality>1</cardinality>
        <optional>false</optional>
      </inputPortSet>
    </inputPorts>
    <outputPorts>
      <outputPortSet>
        <description></description>
        <expressionMode>Expression</expressionMode>
        <autoAssignment>true</autoAssignment>
        <completeAssignment>true</completeAssignment>
        <rewriteAllowed>false</rewriteAllowed>
        <outputFunctions>
          <default>AsIs</default>
          <type>MongoFS</type>
        </outputFunctions>
        <windowPunctuationOutputMode>Generating</windowPunctuationOutputMode>
        <windowPunctuationInputPort>-1</windowPunctuationInputPort>
        <tupleMutationAllowed>false</tupleMutationAllowed>
        <cardinality>1</cardinality>
        <optional>false</optional>
      </outputPortSet>
    </outputPorts>
  </cppOperatorModel>
</operatorModel>